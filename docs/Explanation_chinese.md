# Explanations

本文档包含了有关该项目工作方式的说明。

## 结构
该项目具有以下主要结构：

```plaintext
class Game (整个过程的管理器)
        |
class BackGround (一个地图及其上物品的管理器)
        |
    class Unit
        |(继承关系)
    ---------------------------- ----------------
    |         |                |               |
class Plant  class Zombie      class Sun     class Pea(这里接下来会产生其他子弹)
    |         |
 具体植物    具体僵尸
```
除此之外，还有两个文件：

- `game_parameters.h`，其中列出了游戏的所有参数。你可以更改这些参数，使游戏更能玩。你应该使用`namespace Parameters`来调用这些常量。

- `helper.h`. 这个文件处理一些关系不大的函数，比如把数字转化为字符串.

## 时间管理

该项目有两种不同的时间概念。

- 虚拟时间（普通时间）：
通常情况下提到的time通常是虚拟时间**(即程序执行的主循环次数)。当这个时间改变1时，一切都将更新一次。

- 实时时间（秒）。
虚拟时间通过`Parameters::UPDATE_TIME`变量近似地与实时时间相关联：

```plaintext
实时时间（秒）/ UPDATE_TIME（秒）= 游戏时间
```


## 图像处理

### 概览

根据最新的更新，我们现在使用 Vulkan 包进行管理。图形界面的程序被封装在 `gui` 文件夹内部。

作为一个概览，我们用 `Vulkan::Image` 这个类包装了一个图像。但是图像和游戏的 `unit` 并不是一一对应的关系：一个 `unit` 的图像对应物是一个 `Vulkan::Object`，而多个 `Object` 可能使用一个 `Image`. 这在 Vulkan 中使用 `Descriptor` 实现，不过具体的实现不是很关键.

### 图像操作

创建一个 `Unit` 的时候，为了保证它和管理图像的 `Vulkan::App` (一个实例 `app_` 储存在 `Game` 中)相互联系，需要调用 `MakeObject` 函数. 这个函数相当于通知 `app_` 产生一个对象，然后返回这个对象在 Vulkan 中的序号。

请注意，我们这里使用 Vulkan 的成员都不直接传输指针，而是通过一个 `int` 型序号进行对应，这样方便管理。对于 `Object` 类型，我们有 `Vulkan::App::object_t` 类型，而对于 `Image` 有 `image_t` 类型。这二者其实都是 `int`, 但是可以用来避免把 `Image` 和 `Object` 二者混淆。

一个物品如果要放一张图片在屏幕上，需要传递给 Vulkan 接口的信息是：坐标(x,y)，`Image` 的序号和 `Object` 的序号。在 `Game` 中有多个重载的 `Draw` 函数可以实现各种传递信息的方式。

图形界面图像的移动效果是通过放置图像序列来实现的。每个项目对应一系列图像。变量image_status_将遍历图像编号，并帮助显示相应的图像。

原始图像资源位于 [assets](assets/). 未处理的图片在 [external_images_and_audios](/external_images_and_audio/). 每载入一张图片， Vulkan 就会创造一个 Image 对象并返回给你它的序号。很多函数也实现了这一点。

大部分和图像处理相关的函数全部在 `Game` 这个 class 之中.

## Classes

OOP将项目的不同部分分开。我们已经在代码的每个部分使用 Doxygen 写了详细的注释，我们在这里将解释主要思想。

### Game

此类管理整个过程。在主循环中，它让bkg_（背景）与用户点击进行交互，适当时候创建太阳和僵尸，并让背景更新单位并显示结果。此外，它管理图形界面.

### BackGround

最重要的一点是，每个 `Unit` 都有一个指针和一个 `name_` 。名字可能相同，背景实际上是根据名字而不是指针来对应属性（如图像或价格）。它使用unordered_map来根据单位名字找到属性。

为了使分工有效，使用units_来管理你的单位：

- 如果你想构造一个单位（比如射手射出豌豆子弹），只需简单地将子弹的指针插入 `units_`！你不必再多考虑。
- 
### Unit
单位的“生命周期”是update->show->update->...

当一个单位“死亡”时，将调用其 `Removed` 函数，这将表示该单位即将被移除。

### Sun
太阳是一个典型的单位。它可以在update步骤中移动。

### Plant
植物可以在更新期间执行一些动作。通常，这些动作不是在每一个循环中都完成的（比如产生阳光），所以我们可能使用一个“动作状态”变量来表示当前的动作是否应该完成。

### Pea
`pea`只是子弹的一类.我们接下来会修改来加入更多的子弹.

### Zombie
僵尸是一个Show和Update函数更复杂的单位，因为有各种状态，如吃东西和死亡。它还可以`Attack`植物。